<!DOCTYPE html>

<head></head>
<body>

{% include 'includes/messages.html' %}

<h1>Edit Variables</h1>

<p> Note that deleting a variable will delete all of its associated data!!!!</p>
    <table>

        {% for variable in variables.all %}

        <tr>
            <td>{{ variable }}</td>
            <td>
            <form action="delete/" method="POST">
                {% csrf_token %}
                <button type="submit" name="variable" value={{variable}}>delete</button>
            </form>
            </td>

            {% if variable.is_cat_non_binary %}

                <td><button name="edit-choices" onClick="edit_choices()">Edit variable choices</button></td>
                <div id="edit-choices-container" style="display: none">
                    <p>Old choices: </p>
                    <span>{{ variable.get_choices }}</span> 
                    <form action="edit_choices/" method="POST">
                        {% csrf_token %}
                        <label for="choices">New choices:</label>
                        <input type="text" name="choices">
                        <input type="hidden" name="variable" value={{variable}}>
                        <button type="submit">Submit</button>
                    </form>
                </div>

            {% endif %}

        </tr>
        {% endfor %}
    </table>
    <br>

    {% if num_vars < 11 %}

        <div id="new_variable_container">
            <button onclick="add_variable()">Add variable</button>
            <div id="new_variable_dropdown" style="display:none">
                <label for="type">Variable type:</label>
                <select id="type" name="type" onChange="is_categorical(this)">
                    <option value="continuous">Continuous</option>
                    <option value="binary">Binary</option>
                    <option value="categorical">Categorical</option>
                </select>
                <br>
            </div>
            <div id="new_categorical_variable_container" style="display:none">

                <form action="add_variable/" method="POST">
                    {% csrf_token %}
                    <br> 
                    {{ cat_var_form }}
                    <br>
                    <div id="input_categories_container">

                        <label for="choice">Variable response option: </label>
                        <input type="text" name="choice" maxlength="100" id="choice">
                        <div id="add-category-button-container">
                            <br>
                            <button type="button" onclick="add_category()">add new choice</button>
                            <br>
                        </div>
                    </div>
                    <input type="hidden" name="type" value="categorical">
                    <input type="submit" value="Submit">
                </form>

            </div>
            <div id="non_cat_var_container" style="display:none">

                <form id="non-cat-form" action="add_variable/" method="POST">
                    {% csrf_token %}
                    <br>
                    {{ var_form }}
                    <br>
                    <input type="submit" value="Submit">
                </form>

            </div>
        
        {% else %}

            <p>Cannot add another variable (10 max). Happiness is simple there defs aren't that many factors :)</p>
        
        {% endif %}

        
    </div>

<br>
<a href="/homepage">back to homepage</a>


<script>

    function add_variable() {
        var x = document.getElementById("new_variable_dropdown");
        var hide_me = document.getElementById("new_categorical_variable_container");
        var hide_me_too = document.getElementById("non_cat_var_container");
        if (x.style.display=="none") {
            x.style.display = "block";
            hide_me_too.style.display = "block";
        } else {
            x.style.display = "none";
            hide_me.style.display = "none";
            hide_me_too.style.display = "none";
        }
    }
    
    function is_categorical(element) {
        var cat_var = document.getElementById("new_categorical_variable_container");
        var non_cat_var = document.getElementById("non_cat_var_container");
        if (element.value=="categorical") {
            cat_var.style.display = "block";
            non_cat_var.style.display = "none";
        } else {
            cat_var.style.display = "none";
            non_cat_var.style.display = "block";
            var hidden_type = document.createElement("input");
            hidden_type.setAttribute("type", "hidden");
            hidden_type.setAttribute("name", "type");
            if (element.value=="binary") {
                hidden_type.setAttribute("value", "binary");
            } else if (element.value=="continuous") {
                hidden_type.setAttribute("value", "continuous");
            }
            var add_type = document.getElementById("non-cat-form");
            console.log(hidden_type);
            add_type.appendChild(hidden_type);
        }
    }

    var num_categories = 2;

    function add_category() {
        num_categories = num_categories+1;
        var line_break = document.createElement("br");
        var input_label = document.createElement("label");
        input_label.setAttribute("for", "choice");
        input_label.innerHTML = "Variable response option: "
        var input_category = document.createElement("input");
        input_category.setAttribute("type", "text");
        input_category.setAttribute("name", "choice");
        input_category.setAttribute("max_length", 100);
        input_category.setAttribute("id", "choice");
        document.getElementById("input_categories_container").appendChild(line_break);
        document.getElementById("input_categories_container").appendChild(input_label);
        document.getElementById("input_categories_container").appendChild(input_category);
        document.getElementById("input_categories_container").appendChild(line_break);
        if (num_categories == 10) {
            document.getElementById("add-category-button-container").style.display = "none";
        }
    }

    function edit_choices(variable) {
        var x = document.getElementById("edit-choices-container");
        if (x.style.display=="none") {
            x.style.display = "block";
            hide_me_too.style.display = "block";
        } else {
            x.style.display = "none";
            hide_me.style.display = "none";
            hide_me_too.style.display = "none";
        }


    }

</script>

</body>

